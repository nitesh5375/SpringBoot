What happens internally when you use @AuthenticationPrincipal UserDetails userDetails in a controller method?
ANSWER:

1Ô∏è‚É£ During request processing, your JWT filter validates the token and sets authentication:
SecurityContextHolder.getContext().setAuthentication(authentication);

2Ô∏è‚É£ The Authentication object contains:
principal ‚Üí UserDetails
authorities
isAuthenticated = true

3Ô∏è‚É£ Spring MVC has a HandlerMethodArgumentResolver that:
Detects @AuthenticationPrincipal
Fetches the Authentication object from SecurityContextHolder
Extracts the principal
Injects it into the controller method parameter
UserDetails userDetails =
   (UserDetails) SecurityContextHolder
       .getContext()
       .getAuthentication()
       .getPrincipal();
This is done automatically by Spring.

üî• Why this is useful (Real Reason)
‚úî Avoids extra DB calls
‚úî Gives authenticated user context instantly
‚úî Clean controller code
‚úî Works across all endpoints after authentication


‚ö† Important Interview Edge Case
If:
User is unauthenticated OR
JWT is missing/invalid
Then:
@AuthenticationPrincipal UserDetails userDetails
‚Üí will be null